# Vagrant と Chef による仮想環境構築の自動化 〜 TestKitchenによるテスト入門編〜

※見出しを記述する

## はじめに

本記事のシリーズでは Vagrant と Chef というツールを使い、仮想環境構築を自動化する方法を紹介してきました。環境構築の手順書にあたる Chef のレシピは専用の DSL （Domain Specific Language）を使った Ruby コードです。Chef のレシピをつくる行為は、コードを記述して期待するコンピュータの振る舞いを記述するという点で、通常のソフトウェア開発と同じであると言えます。このため、 Chef のレシピがある程度複雑になってくると、レシピ自身にバグを埋め込んでしまい、期待通りに仮想環境が構築できない現象が発生してしまいます。ここで、期待通りに仮想環境が構築されていないと、リリースされたサービス上で意図しない不具合につながる可能性があります。このため、通常のソフトウェア開発でテストして品質を確認してからリリースするのと同じように、Vagrant と Chef で本番環境を構築してリリースする前にテストで期待通りに仮想環境が構築されているか確認する必要があります。そこで、本記事では Chef のレシピに対してテストを行う方法を紹介します。

## Chef によるレシピ開発で利用するテスト用ツール

Chef-DK（Chef の開発環境）には Chef のレシピをテストするためのツールが最初から梱包されています。本記事では Chef-DK に梱包されたツールおよび外部ツールを使い、仮想環境構築をテストする方法を紹介します。

<dl>
  <dt>Test Kitchen</dt>
  <dd>Chef-DK に梱包されている統合テスティングフレームワーク。Chef のレシピをテストする際のフロントエンドになります。Test Kitchen を通じて Vagrant による仮想環境の構築、テストツールを使ったレシピのテストを行うことができます。</dd>
  <dt>Serverspec</dt>
  <dd>元々は Chef とは無関係なツールです。RSpec 風のテストコードで環境構築結果を確認できるため、レシピの実行結果が期待通りか確認する結合テストツールとして利用します。</dd>
</dl>

## テスト駆動による Chef レシピの開発

![Qiita](http://www.techmatrix.co.jp/quality/concerto/hint/images/hint_agile02_1.jpg "テスト駆動開発")

